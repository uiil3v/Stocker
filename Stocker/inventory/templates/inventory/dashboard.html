{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block fileStyle %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

{% endblock %}

{% block content %}
<div class="container-fluid p-5">


    {% if messages %}
    <div class="container mb-4">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Header -->
    <div class="dashboard-header">
        <h2>Dashboard</h2>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4">
        <div class="col-xl-3 col-md-6">
            <div class="stats-card primary d-flex justify-content-between align-items-center">
                <div>
                    <div class="stats-label">Total Products</div>
                    <div class="stats-number counter-animation">{{ products_count }}</div>
                </div>
                <div class="stats-icon"><i class="fas fa-box"></i></div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card success d-flex justify-content-between align-items-center">
                <div>
                    <div class="stats-label">Categories</div>
                    <div class="stats-number counter-animation">{{ categories_count }}</div>
                </div>
                <div class="stats-icon"><i class="fas fa-tags"></i></div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card info d-flex justify-content-between align-items-center">
                <div>
                    <div class="stats-label">Suppliers</div>
                    <div class="stats-number counter-animation">{{ suppliers_count }}</div>
                </div>
                <div class="stats-icon"><i class="fas fa-truck"></i></div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card danger d-flex justify-content-between align-items-center">
                <div>
                    <div class="stats-label">Low Stock Alert</div>
                    <div class="stats-number counter-animation">{{ low_stock_products|length }}</div>
                </div>
                <div class="stats-icon"><i class="fas fa-exclamation-triangle"></i></div>
            </div>
        </div>
    </div>

    <!-- Low Stock Table -->
    <div class="table-container">
        <div class="table-header">
            <i class="fas fa-exclamation-triangle"></i>
            Low Stock Products
        </div>

        {% if low_stock_products %}
        <div class="table-responsive">
            <table class="table custom-table">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Stock</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in low_stock_products %}
                    <tr>
                        <td>{{ product.name }}</td>
                        <td><span class="badge badge-custom badge-secondary">{{ product.category.name }}</span></td>
                        <td><span class="badge badge-custom badge-danger">{{ product.stock }}</span></td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-plus me-1"></i> Restock
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-check"></i>
            </div>
            <h5>All products well stocked</h5>
            <p>No products require restocking at this time.</p>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Animate numbers
    document.addEventListener('DOMContentLoaded', function () {
        const counters = document.querySelectorAll('.counter-animation');
        counters.forEach(counter => {
            const target = parseInt(counter.innerText);
            let current = 0;
            const step = Math.ceil(target / 30);

            const interval = setInterval(() => {
                current += step;
                if (current >= target) {
                    counter.innerText = target;
                    clearInterval(interval);
                } else {
                    counter.innerText = current;
                }
            }, 30);
        });
    });
</script>

{% endblock %}