{% extends 'base.html' %}
{% load static %}

{% block title %}Supplier Reports{% endblock %}

{% block fileStyle %}
<link rel="stylesheet" href="{% static 'css/supplier_reports.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4 min-vh-100">
    <h2 class="text-center fw-bold mb-3 supplier-reports-header m-auto">Supplier Reports</h2>

    <form method="GET" class="row mb-4">
        <div class="col-md-4">
            <select name="status" class="form-select">
                <option value="">All Status</option>
                <option value="low" {% if selected_status == "low" %}selected{% endif %}>Low Stock</option>
                <option value="expired" {% if selected_status == "expired" %}selected{% endif %}>Expired</option>
                <option value="near" {% if selected_status == "near" %}selected{% endif %}>Near Expiry</option>
            </select>
        </div>
        <div class="col-md-6">
            <input type="text" name="search" class="form-control" placeholder="Search supplier..." value="{{ search_query }}">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-success w-100">Apply</button>
        </div>
    </form>

    <div class="table-responsive table-custom shadow">
        <table class="table table-hover align-middle text-center mb-0">
            <thead class="header-green-dark">
                <tr class="">
                    <th>#</th>
                    <th>Supplier</th>
                    <th>Total Products</th>
                    <th>Low Stock (&lt; {{ low_stock_threshold }} units)</th>
                    <th>Expired</th>
                    <th>Near Expiry ({{ near_expiry_days }} days)</th>
                </tr>
            </thead>
            <tbody>
                {% for data in suppliers_data %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td class="fw-bold">{{ data.supplier.name }}</td>
                        <td>{{ data.total_products }}</td>
                        <td class="text-warning fw-bold">{{ data.low_stock_count }}</td>
                        <td class="text-danger fw-bold">{{ data.expired_count }}</td>
                        <td class="text-info fw-bold">{{ data.near_expiry_count }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="text-muted">No suppliers found.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <div class="d-flex justify-content-end mb-3 mt-4">
        <a href="{% url 'inventory:supplier_reports_pdf' %}?status={{ selected_status }}&search={{ search_query }}" 
        class="btn btn-outline-danger">
            <i class="bi bi-file-earmark-pdf"></i> Download PDF
        </a>
    </div>
</div>
{% endblock %}
